(window.MIP=window.MIP||[]).push({name:"mip-down-comment",func:function(){define("mip-down-comment/mip-down-comment",["require","zepto","customElement"],function(t){function e(){var t=n(".w-text textarea").val(),e=t.length,i=t.replace(/[\x00-\xff]/g,"").length;if(Math.ceil((e+i)/2)<5)n("#verify").addClass("disable");else n("#verify").removeClass("disable")}function i(t){function i(t){var e="";return e+=[t.getFullYear(),t.getMonth()+1,t.getDate()].join("/"),e.replace(/(-|\:)(\d[^\d])/g,"$10$2")}function r(t,e){var i=new Date;i.setTime(i.getTime()+12e4),document.cookie=t+"="+escape(e)+";expires="+i.toGMTString()}function o(t){var e,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");if(e=document.cookie.match(i))return unescape(e[2]);else return null}function s(){d=c.find("li"),n.ajax({url:l+"ajax.asp",data:{content:n(".w-text textarea").val(),SoftID:u,Action:2,CommentTpye:n("#CommentTpye").val()||0},beforeSend:function(){if(n("#submit #verify").hasClass("disable"))return alert("您评论写的太短啦！"),!1;else if(1===o("oldTime"+u))return alert("您评论次数太频繁啦！"),!1},success:function(){var t='<li><p class="user">您发表的跟贴<time><font color="red">'+i(new Date)+"</font></time></p><p>"+n(".w-text textarea").val()+"<p></li>";0===d.length?c.html(t):d.first().before(t),n("#comment #submit").hide(),n("#view-comment").show(),n(".w-text textarea").val("").focus(),r("oldTime"+u,"1")}})}function a(){d=c.find("li"),f=Math.floor(d.length/5+1),n.ajax({type:"get",url:l+"sajax.asp",data:"action=0&id="+u+"&page="+f+"&CommentTpye=0",success:function(t){for(var e="",t=new Function("","return"+t)(),i=t.sUserName,r=t.sUserForm,o=t.sDateAndTime,s=t.sContent,a=0;a<i.length;a++)e+='<li><p class="user">'+r[a]+i[a]+"<time>"+o[a]+"</time></p><p>"+decodeURIComponent(s[a])+"</p></li>";if(t.RecordCount>5)n("#view-comment .button-status-complete").css("display","block"),n("#comment .button").show();if(f>=t.PageCount)n("#view-comment .button").text("没有更多评论了！").unbind("click");0===d.length?c.html(e):d.last().after(e)}})}var l=n(t).find("mip-form").attr("url"),c=n("#comment-list"),u=n("#app-id").val(),d=c.find("li"),f=Math.floor(d.length/5+1);n("#submit #verify").click(function(){return s(),!1}),a(),n("#view-comment .button").bind("click",function(){a()}),n("#view-comment header .fb").click(function(){n("#view-comment").css("display","none"),n("#submit").css("display","block")}),n("#cancel").click(function(){n("#view-comment").css("display","block"),n("#submit").css("display","none")}),n(".w-text textarea").keyup(e)}var n=t("zepto"),r=t("customElement").create();return r.prototype.build=function(){i(this.element)},r}),define("mip-down-comment",["mip-down-comment/mip-down-comment"],function(t){return t}),function(){function t(t,e){t.registerMipElement("mip-down-comment",e)}if(window.MIP)require(["mip-down-comment"],function(e){t(window.MIP,e)});else require(["mip","mip-down-comment"],t)}()}});