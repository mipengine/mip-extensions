define("mip-ck-course-detail/js/comments",["require","zepto","./mediator","./util","./tpl-data"],function(t){function i(t,i){if(i)s.html(t),o=s.find(".comment"),g=!o.length;else o.append(t)}function e(t,e){var n=p.domain+"/wap/mip/course/comments",s={pn:t,courseId:a,sid:l};if(m>0)s.appraise=m;v=!0,c.ajax({url:n,data:s,dataType:"jsonp",success:function(n,s,o){n=n||{};var r=c.trim(n.html||"");if(r)i(r,e);else g=!0;v=!1,f=t},complete:function(){v=!1}})}function n(){r=d.get("courseInfo"),a=r.courseid,l=r.sid,s=c("#comments_box"),h.on("tab-switched",function(t,i){if(2===i){if(b=!0,!x)e(1,!0)}else b=!1}),h.on("window-scroll",function(t,i){if(!g&&!v&&b){var n=u.height()+u.scrollTop();if(s.offset().top+s.height()-n<=10)e(f+1)}}),s.on("click",".comment-complete > a",function(){m=parseInt(c(this).attr("appraise"),10),e(1,!0)})}var s,o,r,a,l,c=t("zepto"),h=t("./mediator"),p=t("./util"),d=t("./tpl-data"),u=c(window),f=0,m=0,g=!1,v=!1,b=!1,x=!1;return n});