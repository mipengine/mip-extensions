(window.MIP=window.MIP||[]).push({name:"mip-html-ajax",func:function(){define("mip-html-ajax/mip-html-ajax",["require","customElement","zepto","viewport","util"],function(t){function e(t,e,n){if(void 0===t.set)return!1;n.find("val-input, val-textarea, val-select,val-option").each(function(){var t=d(this).prop("outerHTML");d(this).prop("outerHTML",t.replace(/<(\/?)val-/gi,"<$1"))}),n.find(t.set.btn).click(function(){return i(t,n),!1}),e.addEventListener("keydown",function(e){if(13===e.keyCode)return i(t,n),!1},!1)}function i(t,e){if(void 0===t.val)return c(v.r102),!1;var i={};for(var r in t.val)if(t.val.hasOwnProperty(r)){var o=e.find(t.val[r]),s=o.attr("val-alt")||"",a=o.attr("min-len")||0,l=o.attr("max-len")||0,u=""!==s?s:v.d100.replace("{name}",r);if("*"===a&&0===o.val().length)return c(u),!1;if(0!==a&&o.val().length<a)return c(u),!1;if(0!==l&&o.val().length>l)return c(u),!1;i[r]=o.val()}n(t,e,i)}function n(t,e,i){var n=t.add.url,r=e.find(t.set.btn);if(""!==n){var o=void 0!==t.add.call?t.add.call:"";n=n.replace("{sid}",t.id).replace("{os}",m),d.ajax({url:n,type:"get",dataType:"jsonp",jsonpCallback:o,data:i,beforeSend:function(){if(r.attr("disabled","disabled"),""!==t.set.btnstr)r.attr("btn-txt",r.val()).val(t.set.btnstr)},error:function(){if("1"===t.add.tip)c(v.g100);if(r.removeAttr("disabled"),""!==t.set.btnstr)r.val(r.attr("btn-txt"))},success:function(i){if("err"===i.success)c(i.msg);else{var n=void 0!==t.tmp?1:0,o=1===n?d(t.tmp.nta).html():s(t.nta),l=1===n?d(t.tmp.ntr).html():s(t.ntr),u=e.find(t.res.upval).val();if(e.find("[empty=true]").val(""),""!==i.msg)c(i.msg);if("0"===u){var p=a(o,i,t);e.find(t.obj.list).append(p)}else{var h=a(l,i,t),m=e.find(t.obj.list).find("#Q"+u);m.find(t.obj.listre).append(h),f.setScrollTop(m.offset().top)}}if(r.removeAttr("disabled"),""!==t.set.btnstr)r.val(r.attr("btn-txt"))}})}}function r(t,e){t.page=void 0!==t.page?t.page:1;var i=t.get.url;if(""!==i){var n=void 0!==t.get.call?t.get.call:"";i=i.replace("{id}",t.id).replace("{page}",t.page).replace("{os}",m);var r=function(i){var n=e.find(t.obj.more);if(void 0!==i.size&&void 0!==i.page&&""!==t.obj.more){var r=n.attr("more-txt")||"",o=i.size,s=i.page;if(o>s){if(""!==r)n.html(r);n.show(),n.attr("on","tap:"+t.theID+".Qmore("+(s+1)+")"),t.page=s+1,t.isMore=!0}else t.isMore=!1,n.remove()}else t.isMore=!1,n.remove()};d.ajax({url:i,type:"get",dataType:"jsonp",jsonpCallback:n,error:function(){if(t.isMore=!1,"1"===t.get.tip)c(v.g101);if(void 0!==t.obj.nodata)if("1"===t.obj.nodata)e.remove()},success:function(i){if("err"===i.state)t.isMore=!1,c(i.msg);else if(void 0!==i[t.obj.arr]){var n=i[t.obj.arr],o=n.length;if(o>0){var u=void 0!==t.tmp?1:0,f=1===u?d(t.tmp.hta).html():s(t.hta),p=1===u?d(t.tmp.htr).html():s(t.htr),h="";if(void 0!==t.obj.arrs)n=l(n);if(!isNaN(t.obj.arrn))o=t.obj.arrn>=o?o:t.obj.arrn;for(var m=0;m<o;m++){var g=a(f,n[m],t);if(g.indexOf("$ReData$")>0&&""!==t.obj.rearr){var v="",y=n[m][t.obj.rearr].length;if(void 0!==t.obj.rearrs)n[m][t.obj.rearr]=l(n[m][t.obj.rearr]);if(!isNaN(t.obj.rearrn))y=t.obj.rearrn>=y?y:t.obj.rearrn;for(var b=0;b<y;b++)v+=a(p,n[m][t.obj.rearr][b],t);g=g.replace("$ReData$",v)}h+=g}e.find(t.obj.list).append(h),t.isLoad=!1}else if(void 0!==t.obj.nodata)if(t.isMore=!1,"1"===t.obj.nodata)e.remove();r(i)}else if(t.isMore=!1,"1"===t.obj.nodata)e.remove()}})}}function o(t,e,i){if(e.addEventAction("Qres",function(e,n){i.find(t.res.show).show().find(t.res.upint).text(n),f.setScrollTop(i.find(t.set.txt).offset().top);var r=setTimeout(function(){i.find(t.set.txt).focus(),clearTimeout(r)},200)}),e.addEventAction("Qreh",function(e,n){i.find(t.res.show).hide().find("em").text(0);var r=setTimeout(function(){i.find(t.set.txt).blur(),clearTimeout(r)},200)}),e.addEventAction("Qrev",function(e,n){i.find(t.res.upval).val(n)}),e.addEventAction("Qmore",function(e,n){var o=i.find(t.obj.more);o.attr("more-txt",o.html()).html(s(t.obj.morestr)),r(t,i)}),e.addEventAction("Qdig",function(e,i){var n=t.dig.url;if(""!==n){var r=void 0!==t.dig.call?t.dig.call:"";n=n.replace("{sid}",i).replace("{os}",m),d.ajax({url:n,type:"get",dataType:"jsonp",jsonpCallback:r,error:function(){if("1"===t.dig.tip)c(v.g102)},success:function(i){if("err"===i.success){if("1"===t.dig.tip)c(i.msg)}else if("1"===t.dig.tip)d(e.target).prepend('<i class="Qdig">+1</i>'),d(e.target).find(".Qdig").fadeOut(800,function(){d(this).remove()}),d(e.target).find("em").text(i.dig);d(e.target).removeAttr("on")}})}}),e.addEventAction("Qbad",function(e,i){var n=t.bad.url;if(""!==n){var r=void 0!==t.bad.call?t.bad.call:"";n=n.replace("{sid}",i).replace("{os}",m),d.ajax({url:n,type:"get",dataType:"jsonp",jsonpCallback:r,error:function(){if("1"===t.bad.tip)c(v.g103)},success:function(i){if("err"===i.success){if("1"===t.bad.tip)c(i.msg)}else if("1"===t.bad.tip)d(e.target).prepend('<i class="Qbad">+1</i>'),d(e.target).find(".Qbad").fadeOut(800,function(){d(this).remove()}),d(e.target).find("em").text(i.bad);d(e.target).removeAttr("on")}})}}),void 0!==t.obj.auto)if("1"===t.obj.auto){var n=void 0!==t.obj.autofoot?t.obj.autofoot:50;d(window).scroll(function(){var e=f.getScrollHeight(),o=f.getHeight();if(f.getScrollTop()>e-o-n)if(t.isMore&&!t.isLoad){var a=i.find(t.obj.more);a.attr("more-txt",a.html()).html(s(t.obj.morestr)),t.isLoad=!0,r(t,i)}})}}function s(t){var e=t;return e=e.replace(/\[\[/g,"<"),e=e.replace(/\]\]/g,">"),e=e.replace(/\|\|/g,"/"),e=e.replace(/\:\:/g,'"'),e=e.replace(/\;\;/g,"'"),e=e.replace(/\+\+/g," ")}function a(t,e,i){t=t.replace(/{thisid}/gi,i.theID);var n=t.match(/{\w+}/gi);if(n)for(var r=0;r<n.length;r++){var o=n[r].match(/{(\w+)}/i);t=t.replace(n[r],e[o[1]])}return t}function l(t){var e=[];for(var i in t)if(t.hasOwnProperty(i))e.push(t[i]);for(var n=[],r=0;r<t.length&&e.length>0;r++){var o=Math.floor(Math.random()*e.length);n[r]=e[o],e.splice(o,1)}return n}function c(t,e){if(e=e||1600,d(".mip-html-ajax-tip").length>0)d(".mip-html-ajax-tip").remove();d("body").append('<div class="mip-html-ajax-tip">'+t+"</div>");var i=setTimeout(function(){d(".mip-html-ajax-tip").fadeOut(100,function(){d(this).remove()}),clearTimeout(i)},e)}var u=t("customElement").create(),d=t("zepto"),f=t("viewport"),p=t("util"),h=p.platform,m=h.isAndroid()?1:h.isIos()?2:0,g="Qping",v={r100:"获取配置json失败",r101:"配置json格式错误",r102:"获取配置json.val错误",d100:"{name}格式不正确",g100:"提交请求出错",g101:"获取请求出错",g102:"dig请求出错",g103:"bad请求出错"};return u.prototype.build=function(){var t=this.element,i=d(t),n=i.find("script[type$=json]"),s=i.attr("id");if(s)g=s;else i.attr("id",g);if(0===n.length)return i.html(v.r100),!1;try{var a=JSON.parse(n.text());a.theID=g,a.isLoad=!1,a.isMore=!1}catch(t){return i.html(v.r101),!1}r(a,i),e(a,t,i),o(a,this,i)},u}),define("mip-html-ajax",["mip-html-ajax/mip-html-ajax"],function(t){return t}),function(){function t(t,e){t.registerMipElement("mip-html-ajax",e,".mip-html-ajax-tip{width:72%;position:fixed;top:40%;left:10%;background:rgba(0,0,0,0.6);color:#fff;text-align:center;padding:15px 4%;line-height:22px;border-radius:6px;font-size:15px;z-index:999999}")}if(window.MIP)require(["mip-html-ajax"],function(e){t(window.MIP,e)});else require(["mip","mip-html-ajax"],t)}()}});