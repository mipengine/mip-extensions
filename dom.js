define("mip-custom/dom",["require","util","templates","fixed-element","mip-custom/log","mip-custom/data"],function(t){function e(t,e){return parseInt(u.css(t,e),10)||0}function i(t,e,i){i.remove();var n=document.querySelectorAll("mip-fixed").length||0,r=e.getAttribute("mip-fixed"),o=e.getAttribute("top")||null,s=e.getAttribute("bottom")||null,a=document.createElement("mip-fixed");if(e.hasAttribute("top")&&o)u.css(a,{top:o});if(e.hasAttribute("bottom")&&s)u.css(a,{bottom:s});if(a.setAttribute("type",r),a.appendChild(e),t.appendChild(a),d._fixedLayer){var c={element:a,id:"Fixed"+n};d.moveToFixedLayer(c,parseInt(n,10)),l(e,d._fixedLayer)}}function n(t,e,i,n,r){var o=r.querySelector(i+"["+n+"]")||document.createElement(i);o.setAttribute(n,"");var s=t.match(e);s&&s.forEach(function(t){var e=new RegExp("<"+i+">([\\S\\s]*)</"+i+">","g"),n=e.exec(t),r=n&&n[1]?n[1]:"";if(-1===o.innerHTML.indexOf(r))o.innerHTML+=r}),r.appendChild(o)}function r(t,e){var i=document.createElement("template");return i.setAttribute("type","mip-mustache"),i.id=e,i.innerHTML=p.subStr(t,h.innerHtml),i}function o(t,e){for(var i=document.createElement(e),n=p.subStr(t,h.tagandAttr).split(" "),o=0;o<n.length;o++){var s=n[o].split("=");if(s[0]&&s[1])i.setAttribute(s[0],s[1].replace(/"/gi,""))}var a=e+"-"+Math.random().toString(36).slice(2);return i.setAttribute("template",a),i.appendChild(r(t,a)),i}function s(t,n,r,s,a){var l=n.replace(h.script,"").replace(h.style,""),d=new RegExp(h.tag,"g").exec(l);if(!(d=d&&d[1]?d[1]:null))return null;var f=o(l,d),p=document.createElement("div");if(p.setAttribute("mip-custom-item",r),p.appendChild(f),a.appendChild(p),f.hasAttribute("mip-fixed"))i(t,f,a);return c.render(f,s,!0).then(function(i){if(i.element.innerHTML=i.html,i.element.hasAttribute("mip-fixed")&&"bottom"===i.element.parentNode.getAttribute("type")){var n=e(i.element,"height"),r=e(t,"padding-bottom");u.css(t,{"padding-bottom":r-10+n})}}),d}function a(t,e,i){for(var r=0;r<e.length;r++){var o=e[r].tplData;if(!(!o||o instanceof Array&&!o.length||o instanceof Object&&!Object.keys(o).length)){var a=e[r].tpl?decodeURIComponent(e[r].tpl):null;if(a){n(a,h.style,"style","mip-custom-css",document.head);var l=s(t,a,r,o,i);if(l)n(a,h.script,"script",l,document.body)}}}}function l(t,e){u.event.delegate(t,"a","click",function(i){if(!this.hasAttribute("mip-link")&&!/clk_info/.test(this.href)){var n=this.getAttribute("data-log-href"),r=null;if(e)r=f.getXPath(this,e),r.unshift(".mip-fixedlayer");else r=f.getXPath(this,t);var o=r?r.join("_"):"",s=n?n:this.href;if(s+=("&"===s[s.length-1]?"":"&")+"clk_info="+JSON.stringify({xpath:o}),n)f.sendLog(s,{});else this.href=s}})}var u=t("util"),c=t("templates"),d=t("fixed-element"),f=t("mip-custom/log"),p=t("mip-custom/data"),h=p.regexs;return{render:a,proxyLink:l}});