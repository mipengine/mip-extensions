define(function(require){var wx=require("./weixinsdk.min");var UA=navigator.userAgent;var isWX=/micromessenger\//i.test(UA);var isBox=/ baiduboxapp\//i.test(UA);var isQQ=/\bqq\b/i.test(UA);var isWeibo=/\bweibo\b/i.test(UA);var emptyFn=function(){};var protocol=location.protocol;var href=location.href;var defaultTitle="百度App";var defaultDesc="百度App";var defaultIcon="https://b.bdstatic.com/searchbox/icms/searchbox/img/po/act/newuserredpack/box_logo.png";var OPTIONS;function objForEach(obj,fn){var key,result;for(key in obj){if(obj.hasOwnProperty(key)){result=fn.call(obj,key,obj[key]);if(result===false){break}}}}function json2Query(json){if(typeof json==="string"){return json}var arr=[];for(var i in json){arr.push(i+"="+json[i])}return arr.join("&")}function trim(s){return s.replace(/^\s+/,function(){return""}).replace(/\s+$/,function(){return""})}function loadJS(opts){var HEAD=document.head||document.getElementsByTagName("head")[0]||document.documentElement;var js=document.createElement("script");js.type="text/javascript";var url,data,success,error,timeout;url=opts.url;data=opts.data;success=opts.success||emptyFn;error=opts.error||emptyFn;timeout=opts.timeout||2e4;if(typeof data==="object"){data=json2Query(data)}if(data){url+=(url.indexOf("?")===-1?"?":"&")+data}url=url.replace(/[&?]{1,2}/,"?");var callbackName;if(/=\?/.test(url)){callbackName="_box_jsonp"+Date.now();url=url.replace(/=\?/,"="+callbackName)}js.src=url;var done=true,timer;var clear=function(){if(callbackName){delete window[callbackName]}timer&&clearTimeout(timer);js.onload=js.onreadystatechange=js.onerror=null;js=null};var cb=function(evt,isTimeout){if(js&&(!js.readyState||/loaded|complete/.test(js.readyState))){clear();if(done&&typeof success==="function"){success.apply(null,[].slice.call(arguments))}done=false}};var errorCallback=function(evt){clear();if(done){error(evt)}done=false};if(callbackName){window[callbackName]=cb}timer=setTimeout(function(){clear();if(done){error("timeout")}done=false},timeout);js.onload=js.onreadystatechange=js.onerror=cb;js.onerror=errorCallback;HEAD.appendChild(js)}function getText(elem){if(elem.nodeType!==1){return""}var result=elem.innerHTML.replace(/\n/gim,function(){return""}).replace(/<script.*?script>/gim,function(){return""}).replace(/(<.*?>)|(<script>.*?<\/script>)/gim,function(){return""});return trim(result)}function getShareImg(callback,defaultUrl){var imgsOfPage=document.getElementsByTagName("img");var index,item;var length=imgsOfPage.length;length=length<=10?length:10;for(index=0;index<length;index++){item=imgsOfPage[index];(function(src){var newImg=document.createElement("img");newImg.src=src;newImg.onload=function(){if(newImg.width>290&&newImg.height>290){callback(newImg.src)}}})(item.src)}setTimeout(function(){callback(defaultUrl)},1e3)}function sendErrorLog(evt,msg){if(Math.random()<=.95&&href.indexOf("share_config_random=1")<0){return}if(!evt||!msg){return}msg=encodeURIComponent(msg);var page_id="300_001";var tcboxUrl="//m.baidu.com/tcbox?service=bdbox&action=pblog&data="+encodeURIComponent(JSON.stringify({appid:1,dataid:2,cateid:26,actionid:2,actiontype:"0",actiondata:{type:0,timestamp:Date.now(),content:{page_id:page_id,logtype:3,type:"c_"+evt,msg:msg}}}));var ispeedUrl="//ispeed.baidu.com/e.gif?t="+Date.now()+"&page_id="+page_id+"&evt=c_"+evt+"&msg="+msg;var urls=[protocol+tcboxUrl,protocol+ispeedUrl];urls.forEach(function(url){var img=document.createElement("img");img.onload=img.onerror=img.onabort=function(){img=null};img.src=url})}function shareHandle(options,success,fail){var debug=!!options.debug;if(isBox){delete options.wx;var bdbox=options.bdbox||{};if(!bdbox.source){sendErrorLog("no_bdbox_source",href);if(debug){}return}var data={type:"url",mediaType:"all",linkUrl:href,source:bdbox.source};for(var i in options){if(i!=="bdbox"){data[i]=options[i]}}window["__BdboxShare_success__"]=success||console.log;window["__BdboxShare_fail__"]=fail||console.log;window.BoxShareData={options:data,successcallback:"__BdboxShare_success__",errorcallback:"__BdboxShare_fail__"}}else if(isWX||isQQ){delete options.bdbox;options.wx=options.wx||{};options.wx.appId=options.wx.appId||"wxadc1a0c6b9096e89";options.wx.jsApiList=options.wx.jsApiList||[];options.wx.jsApiList=options.wx.jsApiList.concat(["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]);loadJS({url:protocol+options.wx.api,data:{url:encodeURIComponent(href),callback:"?",ts:Date.now()},success:function(res){if(res.errno!=0){sendErrorLog("wx_gettoken_err",href);if(debug){}return}var data=res.data||{};if(isWX){wx.config({debug:debug,jsApiList:options.wx.jsApiList,appId:data.appId,nonceStr:data.nonceStr,timestamp:data.timestamp,signature:data.signature});var configData={title:options.title,desc:options.content,link:options.linkUrl,imgUrl:options.iconUrl,success:function(){success&&success()},cancel:function(){fail&&fail()}};wx.ready(function(){wx.onMenuShareTimeline(configData);wx.onMenuShareAppMessage(configData);wx.onMenuShareQQ(configData);wx.onMenuShareWeibo(configData);wx.onMenuShareQZone(configData)})}if(isQQ){setShareInfo({title:options.title,summary:options.content,pic:options.iconUrl,url:options.linkUrl,WXconfig:{swapTitleInWX:false,appId:data.appId,timestamp:data.timestamp,nonceStr:data.nonceStr,signature:data.signature}})}}})}}function initConfig(options,success,fail){if(typeof options!=="object"){return}OPTIONS=options;var debug=!!options.debug;if(isWX&&!wx){if(debug){}return}if(isQQ&&!window.setShareInfo){if(debug){}return}if(!options.titleDefault){options.titleDefault=defaultTitle}if(!options.contentDefault){options.contentDefault=defaultDesc}if(!options.iconUrlDefault){options.iconUrlDefault=defaultIcon}if(!options.title){options.title=trim(document.title);if(!options.title){options.title=options.titleDefault}}if(!options.linkUrl){options.linkUrl=href}if(!options.content){options.content=document.body}if(options.content.nodeType===1){options.content=getText(options.content)}if(!options.content||typeof options.content!=="string"){options.content=options.contentDefault}if(options.content.length>50){options.content=options.content.slice(0,50)+"..."}var _isGetImgCalled=false;if(!options.iconUrl){getShareImg(function(result){if(_isGetImgCalled){return}_isGetImgCalled=true;options.iconUrl=result;shareHandle(options,success,fail)},options.iconUrlDefault)}else{shareHandle(options,success,fail)}}var sealConfig={init:function(){var _arguments=arguments;if(isWX){if(wx){initConfig.apply(this,_arguments)}else{initConfig.apply(this,_arguments)}}else{initConfig.apply(this,_arguments)}},update:function(options){if(!OPTIONS){return}objForEach(OPTIONS,function(key,val){if(options[key]==null){options[key]=val}});if(isWX){if(wx){initConfig.call(this,options)}}else{initConfig.call(this,options)}}};function shareConfig(options){var defaultConfig=options;defaultConfig["channel"]="pageSeach";defaultConfig["debug"]=false;defaultConfig["linkUrl"]=location.href;sealConfig.init(defaultConfig)}shareConfig.prototype.update=function(options){sealConfig.update(options)};return shareConfig});